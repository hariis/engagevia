<div id="post-content">
  <div id="actual-post-content">
                    <div id="parent-post">                         
                      <div id="post-body">
                        <% if @post.owner == @user  %>
                           <div class="subject">  <%= in_place_editor_field :post, 'subject',{}, :size => '80', :text_between_controls => ' or ',:save_text => 'save' %> </div>
                           <div class="url"><%= in_place_editor_field :post, 'url',{}, :size => '80', :text_between_controls => ' or ',:save_text => 'save' %></div>
                           <%= in_place_rich_editor_field :post, :description ,{}, :mode => 'tinymce_advanced_with_save_options' %>
                        <% else %>
                           <div class="subject">  <%=  @post.subject %></div>
                           <% if @post.url != "Add a link" %>
                           <div class="url">Check out:<%= link_to h(@post.url) , h(@post.url) %></div>
                           <% end %>
                           <div class="description">  <%= @post.description %></div>
                        <% end %>                        
                      </div>
                      <span style="color:#0062f6;">
                      started by <%= "#{@post.owner.display_name} <br/>   #{@post.created_at.to_s(:short)}" %></span>
                      <span  style="color:#0062f6;float:right;width:8%;">
                      <%= image_tag @post.owner.avatar.url(:thumb) if @post.owner.avatar.file? %></span>
                    </div>
    <% engagements = Engagement.find(:all,:conditions => ["post_id = ?", @post.id]) %>
    <%  engagements_by_invite = engagements.group_by { |t| t.invited_by } if engagements %>
    <% if engagements_by_invite %>
      <div id="invitations">
        <ul>
          <% engagements_by_invite.sort.each do |invited_by, engagements| %>
          <li>
            <span class="inviter"><strong><%= User.find(invited_by).display_name %></strong>  </span> invited <br/>
            <% invitees = [] %>
            <%  engagements_by_date = engagements.group_by { |t| t.invited_when } if engagements %>
            <% engagements_by_date.sort.each do |invited_when, engagements| %>
            <% engagements.each do |engagement| %>
                <% invitee = User.find(engagement.user_id) %>
                <% invitees << invitee.display_name(nil,engagement) if @post.owner.id != invitee.id %>
            <% end %>
            <% if invitees.length > 0 %>
            <%= invitees.join(", ")  %>  <%= distance_of_time_in_words(@post.created_at, invited_when.in_time_zone) + " later" %>  <br/>
            <% invitees = [] %>
            <% end %>
            <% end %>
            
            </li>
          <% end %>
        </ul>
      </div>
    <% end %>
                    <div id="comments">                      
                      <h3>Comments</h3>
                      <%= render :partial => "/comments/comment", :collection => @post.comments.roots, :locals => {:root => 'true',:parent_comment => nil} %>
                      <br/>
                      <h3>Add Your Comment</h3>
                      <div class="new-comment root comment-body">
                        <%  @comment = Comment.new(:body => "Click here to add your comment") %>
                        <div class="comment-body-editor">
                          
                          <%= in_place_rich_editor_field :comment, :body ,{},:url => { :controller => :comments, :action => :create, :post_id => @post.id, :uid => params[:uid]}, :mode => 'tinymce_advanced_with_save_options' %>
                        </div>
                        <span  style="color:#0062f6;float:right;width:8%;">
                        <%= image_tag @user.avatar.url(:thumb),:size=> "32x32"  if @user.avatar.file? %></span>
                        <div id="owner-info"  style="color:#0062f6;clear:both;float:right;">
                        <%= image_tag "comment.png" %> <%= "#{@user.display_name(@post)}" %></div>
                      </div>
                   </div>
  </div>
</div>
